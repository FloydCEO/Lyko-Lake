<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyko Lake - BETA Tycoon Game</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
            background:radial-gradient(ellipse at bottom,#1a3d2e 0%,#0d2818 50%,#06140f 100%);
            color:#e0f2e9;min-height:100vh;
            background-attachment:fixed;
        }
        .hidden{display:none!important}
        nav{
            background:rgba(13,40,24,.85);backdrop-filter:blur(10px);
            padding:20px 40px;display:flex;justify-content:space-between;align-items:center;
            position:sticky;top:0;z-index:1000;
            box-shadow:0 4px 20px rgba(0,0,0,.4);
            border-bottom:2px solid rgba(88,166,100,.4);
        }
        .logo{font-size:1.8em;font-weight:bold;color:#88d8a3;text-decoration:none;display:flex;align-items:center;gap:10px;transition:transform .3s ease}
        .logo:hover{transform:scale(1.05)}
        .container{max-width:800px;margin:100px auto;padding:20px;text-align:center}
        h1{font-size:3em;margin-bottom:20px;color:#88d8a3}
        p{margin-bottom:40px;color:rgba(224,242,233,.8)}
        .button{background:#88d8a3;color:#0d2818;padding:15px 40px;border-radius:10px;text-decoration:none;font-weight:600;display:inline-block;margin:10px;transition:all .3s ease}
        .button:hover{background:#a3e8b8;transform:translateY(-3px)}
        .search-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:2000}
        .search-modal.show{display:flex}
        .search-content{background:rgba(13,40,24,.95);padding:40px;border-radius:20px;max-width:500px;width:90%;text-align:left}
        .search-input{width:100%;padding:15px;background:rgba(255,255,255,.1);border:2px solid #88d8a3;border-radius:10px;color:#fff;margin-bottom:20px}
        .search-results{max-height:300px;overflow-y:auto}
        .search-result{padding:10px;border-bottom:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:10px}
        .search-result a{color:#88d8a3;text-decoration:none}
        .beta-tag{color:#ffcc00;font-size:0.8em;margin-left:10px}
    </style>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDUBeWvs6kOijqST6FVGirWs2EZ12aAAwU",
            authDomain: "lyko-lake.firebaseapp.com",
            projectId: "lyko-lake",
            storageBucket: "lyko-lake.firebasestorage.app",
            messagingSenderId: "685592614306",
            appId: "1:685592614306:web:b6a8f6f18407f9c0154efb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        onAuthStateChanged(auth, async user => {
            if (user && user.emailVerified) {
                const snap = await getDoc(doc(db, 'users', user.uid));
                if (snap.exists()) {
                    currentUser = { ...snap.data(), userId: user.uid };
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('menuSection').classList.remove('hidden');
                    document.getElementById('profileLink').href = `/profile.html?u=${currentUser.username}`;
                }
            } else {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('menuSection').classList.add('hidden');
            }
        });

        document.getElementById('searchButton').addEventListener('click', () => {
            document.getElementById('searchModal').classList.add('show');
        });

        document.getElementById('closeSearch').addEventListener('click', () => {
            document.getElementById('searchModal').classList.remove('show');
        });

        document.getElementById('playerSearchInput').addEventListener('input', async e => {
            const queryStr = e.target.value.toLowerCase();
            if (queryStr.length < 3) return;
            const q = query(collection(db, 'usernames'), where('username', '>=', queryStr), where('username', '<=', queryStr + '\uf8ff'));
            const snaps = await getDocs(q);
            const results = document.getElementById('searchResults');
            results.innerHTML = '';
            snaps.forEach(snap => {
                const data = snap.data();
                results.innerHTML += `<div class="search-result">
                    <a href="/profile.html?u=${data.username}">${data.username}</a>
                    <button onclick="addFriend('${data.userId}')">Add Friend</button>
                </div>`;
            });
        });

        window.addFriend = async (friendId) => {
            if (!currentUser) return;
            await addDoc(collection(db, 'follows'), { followerId: currentUser.userId, followingId: friendId });
            alert('Friend added!');
        };
    </script>
</head>
<body>
    <nav>
        <a href="/" class="logo">Lyko Lake <span class="beta-tag">BETA</span></a>
        <div class="nav-right">
            <a href="/help.html" class="button">Help</a>
            <a id="adminLink" href="/admin.html" class="button hidden">Admin</a>
        </div>
    </nav>
    <div class="container">
        <h1>Welcome to Lyko Lake Tycoon</h1>
        <p>A multiplayer .io tycoon game where you build your empire through missions and properties. BETA - In Progress!</p>
        
        <div id="authSection">
            <a href="/auth.html" class="button">Sign In / Sign Up</a>
        </div>
        
        <div id="menuSection" class="hidden">
            <a href="/game.html" class="button">Start Game</a>
            <a id="profileLink" href="#" class="button">My Profile</a>
            <a id="searchButton" class="button">Search Players</a>
            <a href="/customize.html" class="button">Customize Character</a>
        </div>
    </div>
    
    <div id="searchModal" class="search-modal">
        <div class="search-content">
            <h2>Search Players</h2>
            <input id="playerSearchInput" type="text" placeholder="Enter username..." class="search-input">
            <div id="searchResults" class="search-results"></div>
            <button id="closeSearch" class="button">Close</button>
        </div>
    </div>
    
    <div class="version-footer">Â©2025 Lyko Sokolov - Lyko Lake v1.1.0 BETA</div>
</body>
</html>
