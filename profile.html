<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile – Lyko Lake</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
            background:radial-gradient(ellipse at bottom,#1a3d2e 0%,#0d2818 50%,#06140f 100%);
            color:#e0f2e9;min-height:100vh;
            background-attachment:fixed;
        }
        .hidden{display:none !important}
        nav{
            background:rgba(13,40,24,.85);backdrop-filter:blur(10px);
            padding:20px 40px;display:flex;justify-content:space-between;align-items:center;
            position:sticky;top:0;z-index:1000;
            box-shadow:0 4px 20px rgba(0,0,0,.4);
            border-bottom:2px solid rgba(88,166,100,.4);
        }
        .logo{font-size:1.8em;font-weight:bold;color:#88d8a3;text-decoration:none;display:flex;align-items:center;gap:10px}
        .container{max-width:800px;margin:60px auto;padding:20px}
        .profile-header{text-align:center;margin-bottom:40px}
        .profile-name{font-size:2.5em;color:#88d8a3}
        .profile-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
        .stat-card{background:rgba(13,40,24,.5);padding:20px;border-radius:10px;border:2px solid #88d8a3;text-align:center}
        .character-preview{width:200px;height:300px;margin:20px auto;background:#fff;border-radius:10px;overflow:hidden} /* Placeholder SVG container */
        .beta-tag{color:#ffcc00;font-size:0.8em}
    </style>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDUBeWvs6kOijqST6FVGirWs2EZ12aAAwU",
            authDomain: "lyko-lake.firebaseapp.com",
            projectId: "lyko-lake",
            storageBucket: "lyko-lake.firebasestorage.app",
            messagingSenderId: "685592614306",
            appId: "1:685592614306:web:b6a8f6f18407f9c0154efb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        function getUsernameFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('u');
        }

        async function loadProfile(username) {
            try {
                const usernameSnap = await getDoc(doc(db, 'usernames', username.toLowerCase()));
                if (!usernameSnap.exists()) throw new Error('User not found');
                const userId = usernameSnap.data().userId;
                const userSnap = await getDoc(doc(db, 'users', userId));
                if (!userSnap.exists()) throw new Error('Profile not found');
                const userData = userSnap.data();

                document.getElementById('profileName').textContent = userData.username || 'Unknown';
                document.getElementById('level').textContent = userData.level || 1;
                document.getElementById('money').textContent = `$${userData.money || 0}`;
                document.getElementById('properties').innerHTML = userData.properties?.join('<br>') || 'None';

                // Character preview (simple SVG placeholder)
                const char = userData.character || {hair: 'black', eyes: 'brown', skin: 'light', clothes: 'casual'};
                const svg = `
                    <svg width="200" height="300">
                        <rect x="50" y="50" width="100" height="150" fill="${char.skin === 'light' ? '#ffdab9' : '#cd853f'}"/> <!-- Body -->
                        <circle cx="100" cy="30" r="30" fill="${char.hair}"/> <!-- Hair/Head -->
                        <circle cx="80" cy="30" r="5" fill="${char.eyes}"/> <!-- Eyes -->
                        <circle cx="120" cy="30" r="5" fill="${char.eyes}"/>
                        <rect x="50" y="200" width="100" height="100" fill="${char.clothes === 'casual' ? '#add8e6' : '#ff0000'}"/> <!-- Clothes -->
                    </svg>`;
                document.getElementById('characterPreview').innerHTML = svg;

                if (userData.avatar) {
                    document.getElementById('characterPreview').innerHTML = `<img src="${userData.avatar}" style="width:200px;height:300px;object-fit:cover;">`;
                }

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('profileContent').classList.remove('hidden');
            } catch (error) {
                showError(error.message);
            }
        }

        function showError(msg) {
            document.getElementById('errorText').textContent = msg;
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('errorContent').classList.remove('hidden');
        }

        const username = getUsernameFromUrl();
        if (username) {
            loadProfile(username);
        } else {
            showError('Please provide a username in the URL.');
        }
    </script>
</head>
<body>
    <nav>
        <a href="/" class="logo">Lyko Lake <span class="beta-tag">BETA</span></a>
    </nav>
    <div class="container">
        <div id="loading">Loading profile...</div>
        <div id="profileContent" class="hidden">
            <div class="profile-header">
                <h1 class="profile-name" id="profileName"></h1>
                <div id="characterPreview" class="character-preview"></div>
            </div>
            <div class="profile-stats">
                <div class="stat-card">
                    <h2>Level</h2>
                    <p id="level">1</p>
                </div>
                <div class="stat-card">
                    <h2>Money</h2>
                    <p id="money">$0</p>
                </div>
                <div class="stat-card">
                    <h2>Properties</h2>
                    <p id="properties">None</p>
                </div>
            </div>
        </div>
        <div id="errorContent" class="hidden">
            <p id="errorText"></p>
        </div>
    </div>
    <div style="position:fixed;bottom:10px;left:10px;color:rgba(224,242,233,0.5);font-size:0.8em;z-index:1000;pointer-events:none">
        ©2025 Lyko Sokolov - Lyko Lake v1.1.0 BETA
    </div>
</body>
</html>
