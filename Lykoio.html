<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>LykoIO â€“ LilLyko.space</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=DM+Mono:wght@300;400&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --void:#07080f;--surf:#121428;--bord:#1e2240;
  --red:#e94560;--gold:#f5a623;--cyan:#00e5ff;
  --green:#39ff8f;--text:#dce8ff;--dim:#5a6a90;
}
html,body{width:100%;height:100%;background:var(--void);color:var(--text);
  font-family:'DM Mono',monospace;overflow:hidden;user-select:none}

/* â”€â”€ LOBBY â”€â”€ */
#lobby{position:fixed;inset:0;background:var(--void);z-index:99;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px}
#lobby::before{content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  opacity:.4;pointer-events:none}
.owrap{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  width:600px;height:600px;pointer-events:none;opacity:.04}
.orb{position:absolute;inset:0;border:1px solid #fff;border-radius:50%;animation:spin 40s linear infinite}
.orb:nth-child(2){inset:60px;border-color:var(--cyan);animation-duration:60s;animation-direction:reverse}
.orb:nth-child(3){inset:130px;animation-duration:80s}
@keyframes spin{to{transform:rotate(360deg)}}
.scanl{position:fixed;inset:0;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px)}
.li{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:22px}
.leyebrow{font-size:11px;letter-spacing:4px;color:var(--dim);text-transform:uppercase}
.leyebrow span{color:var(--gold)}
#lobby h1{font-family:'Orbitron',sans-serif;font-size:clamp(44px,8vw,88px);color:#fff;letter-spacing:2px;line-height:1}
#lobby h1 .io{color:var(--cyan)}
.ldiv{width:120px;height:1px;background:linear-gradient(90deg,transparent,var(--cyan),transparent)}
#connStatus{font-size:10px;letter-spacing:3px;padding:6px 18px;border:1px solid var(--bord);
  color:var(--dim);text-transform:uppercase;transition:color .3s,border-color .3s}
#connStatus.ok{color:var(--green);border-color:var(--green)}
#connStatus.err{color:var(--red);border-color:var(--red)}
#nameIn{background:var(--surf);border:1px solid var(--bord);color:var(--text);
  font-family:'DM Mono',monospace;font-size:16px;padding:13px 24px;width:290px;
  outline:none;letter-spacing:2px;text-align:center;transition:border-color .3s}
#nameIn:focus{border-color:var(--cyan)}
#playBtn{background:var(--cyan);color:var(--void);font-family:'Orbitron',sans-serif;
  font-size:13px;font-weight:700;letter-spacing:3px;border:none;
  padding:14px 52px;cursor:pointer;transition:background .2s,transform .1s}
#playBtn:hover:not(:disabled){background:#fff;transform:scale(1.04)}
#playBtn:disabled{opacity:.4;cursor:not-allowed}
.lhints{font-size:10px;letter-spacing:1px;color:var(--dim);text-align:center;line-height:2.2}
.lhints span{color:var(--gold)}
.bklink{font-size:10px;letter-spacing:2px;color:var(--dim);text-decoration:none;transition:color .2s}
.bklink:hover{color:var(--cyan)}

/* â”€â”€ CANVAS â”€â”€ */
canvas{display:block;position:fixed;inset:0;z-index:0}

/* â”€â”€ HUD â”€â”€ */
#hud{position:fixed;inset:0;pointer-events:none;z-index:10;display:none}
#stats{position:absolute;top:14px;left:14px;background:rgba(7,8,15,.9);
  border:1px solid var(--bord);padding:14px 18px;min-width:205px}
#sName{font-family:'Orbitron',sans-serif;font-size:12px;color:#fff;letter-spacing:2px;margin-bottom:10px}
.brow{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.blbl{font-size:9px;letter-spacing:2px;color:var(--dim);width:24px}
.bar{flex:1;height:5px;background:var(--bord)}
.bfill{height:100%;transition:width .3s}
.bfill.hp{background:var(--red)}.bfill.xp{background:var(--cyan)}
.bval{font-size:9px;color:var(--dim);width:56px;text-align:right}
#sLvl{font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold);letter-spacing:2px;margin-top:8px}
#sKills{font-size:9px;color:var(--dim);letter-spacing:1px;margin-top:3px}
#mm{position:absolute;top:14px;right:14px;width:158px;height:158px;
  background:rgba(7,8,15,.9);border:1px solid var(--bord);overflow:hidden}
#invBar{position:absolute;bottom:14px;left:50%;transform:translateX(-50%);
  display:flex;gap:5px;pointer-events:all}
.isl{width:52px;height:52px;background:rgba(7,8,15,.92);border:1px solid var(--bord);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  cursor:pointer;position:relative;transition:border-color .2s;font-size:22px}
.isl:hover{border-color:var(--cyan)}.isl.eq{border-color:var(--gold)}
.isl .sn{position:absolute;bottom:2px;font-size:7px;letter-spacing:.5px;color:var(--dim);
  white-space:nowrap;overflow:hidden;max-width:48px;text-align:center}
.iempty{opacity:.2;font-size:16px;color:var(--dim)}
#tip{position:fixed;background:rgba(7,8,15,.96);border:1px solid var(--bord);
  padding:10px 14px;font-size:11px;z-index:200;pointer-events:none;display:none;
  max-width:190px;line-height:1.7}
#tip .tn{font-family:'Orbitron',sans-serif;font-size:12px;color:#fff}
.rc{color:var(--dim)}.ru{color:var(--green)}.rr{color:var(--cyan)}
#tip .th{color:var(--gold);font-size:9px;letter-spacing:1px;margin-top:5px}
#kf{position:absolute;top:14px;left:50%;transform:translateX(-50%);
  display:flex;flex-direction:column;align-items:center;gap:5px;pointer-events:none}
.kfe{background:rgba(7,8,15,.9);border:1px solid var(--bord);padding:5px 14px;
  font-size:10px;letter-spacing:2px;animation:kfi .3s both,kfo .4s 3.6s both}
.kk{color:var(--cyan)}.kv{color:var(--red)}
@keyframes kfi{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
@keyframes kfo{to{opacity:0}}
#ctrl{position:absolute;bottom:80px;left:14px;font-size:9px;letter-spacing:1px;
  color:var(--dim);line-height:2;pointer-events:none}
#ctrl span{color:var(--text)}

/* â”€â”€ DEATH â”€â”€ */
#death{position:fixed;inset:0;background:rgba(7,8,15,.93);z-index:50;
  display:none;flex-direction:column;align-items:center;justify-content:center;gap:18px;
  font-family:'Orbitron',sans-serif}
#death h2{font-size:52px;color:var(--red);letter-spacing:4px}
#death p{font-size:12px;color:var(--dim);letter-spacing:3px}
.drow{display:flex;gap:44px;margin-top:6px}
.ds{text-align:center}.dv{font-size:34px;color:#fff;display:block}
.dl{font-size:9px;letter-spacing:3px;color:var(--dim)}
#rbtn{background:var(--red);color:#fff;font-family:'Orbitron',sans-serif;
  font-size:12px;font-weight:700;letter-spacing:3px;border:none;
  padding:14px 40px;cursor:pointer;margin-top:14px;transition:background .2s}
#rbtn:hover{background:#fff;color:var(--void)}

/* â”€â”€ DISCONNECTED â”€â”€ */
#dcScreen{position:fixed;inset:0;background:rgba(7,8,15,.96);z-index:60;
  display:none;flex-direction:column;align-items:center;justify-content:center;gap:16px;
  font-family:'Orbitron',sans-serif}
#dcScreen h2{font-size:32px;color:var(--gold);letter-spacing:3px}
#dcScreen p{font-size:11px;color:var(--dim);letter-spacing:2px}
.dcbtn{background:var(--cyan);color:var(--void);font-family:'Orbitron',sans-serif;
  font-size:11px;font-weight:700;letter-spacing:2px;border:none;
  padding:10px 28px;cursor:pointer;margin-top:8px}

/* â”€â”€ LEVEL UP FLASH â”€â”€ */
#lvlFlash{position:fixed;inset:0;pointer-events:none;z-index:40;
  display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}
#lvlFlash.on{opacity:1}
#lvlFlash span{font-family:'Orbitron',sans-serif;font-size:58px;font-weight:900;
  color:var(--gold);text-shadow:0 0 60px var(--gold)}

/* â”€â”€ ISLAND UNLOCK BANNER â”€â”€ */
#islBanner{position:fixed;inset:0;background:rgba(7,8,15,.93);z-index:48;
  display:none;flex-direction:column;align-items:center;justify-content:center;gap:16px;
  font-family:'Orbitron',sans-serif}
#islBanner h2{font-size:36px;color:var(--gold);letter-spacing:3px}
#islBanner p{font-size:11px;color:var(--dim);letter-spacing:2px;text-align:center;line-height:1.9}
.islbtn{background:var(--gold);color:var(--void);font-family:'Orbitron',sans-serif;
  font-size:11px;font-weight:700;letter-spacing:2px;border:none;
  padding:10px 28px;cursor:pointer;margin-top:8px}
</style>
</head>
<body>

<!-- Lobby -->
<div id="lobby">
  <div class="owrap"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>
  <div class="scanl"></div>
  <div class="li">
    <p class="leyebrow">Welcome to <span>LilLyko.space</span></p>
    <h1>LYKO<span class="io">IO</span></h1>
    <div class="ldiv"></div>
    <div id="connStatus">âŸ³ CONNECTING TO SERVER...</div>
    <input id="nameIn" type="text" placeholder="ENTER YOUR NAME" maxlength="16" spellcheck="false">
    <button id="playBtn" disabled>ENTER THE ISLAND</button>
    <div class="lhints">
      <span>WASD</span> move &nbsp;Â·&nbsp; <span>Click</span> enemy to attack<br>
      <span>Click</span> item to use / equip &nbsp;Â·&nbsp; <span>Right-click</span> to drop<br>
      Kill animals for XP &nbsp;Â·&nbsp; Kill players for <span>+200 bonus XP</span><br>
      Reach <span>Level 10</span> to unlock the next island
    </div>
    <a class="bklink" href="index.html">â† Back to LilLyko.space</a>
  </div>
</div>

<canvas id="c"></canvas>

<div id="hud">
  <div id="stats">
    <div id="sName">â€”</div>
    <div class="brow"><span class="blbl">HP</span><div class="bar"><div class="bfill hp" id="hpB" style="width:100%"></div></div><span class="bval" id="hpV">100/100</span></div>
    <div class="brow"><span class="blbl">XP</span><div class="bar"><div class="bfill xp" id="xpB" style="width:0%"></div></div><span class="bval" id="xpV">0/100</span></div>
    <div id="sLvl">LVL 1</div>
    <div id="sKills">Kills: 0 | PvP: 0</div>
  </div>
  <div id="mm"><canvas id="mmc" width="158" height="158"></canvas></div>
  <div id="invBar"></div>
  <div id="kf"></div>
  <div id="ctrl"><span>WASD</span> â€“ Move<br><span>Click</span> enemy â€“ Attack<br><span>Click</span> item â€“ Use/Equip<br><span>Right-click</span> â€“ Drop</div>
</div>

<div id="tip"></div>

<div id="death">
  <h2>YOU DIED</h2>
  <p id="dBy">Killed by the void</p>
  <div class="drow">
    <div class="ds"><span class="dv" id="dK">0</span><span class="dl">KILLS</span></div>
    <div class="ds"><span class="dv" id="dP">0</span><span class="dl">PVP</span></div>
    <div class="ds"><span class="dv" id="dL">1</span><span class="dl">LEVEL</span></div>
  </div>
  <button id="rbtn">RESPAWN</button>
</div>

<div id="dcScreen">
  <h2>DISCONNECTED</h2>
  <p>Lost connection to the server.</p>
  <button class="dcbtn" onclick="location.reload()">RECONNECT</button>
</div>

<div id="islBanner">
  <h2>âœ¦ ISLAND UNLOCKED âœ¦</h2>
  <p>You've reached <b style="color:var(--gold)">MAX LEVEL</b> on Island 1.<br>Island 2 is under construction â€” check back soon.</p>
  <button class="islbtn" onclick="document.getElementById('islBanner').style.display='none'">KEEP PLAYING</button>
</div>

<div id="lvlFlash"><span>LEVEL UP!</span></div>

<!-- Socket.io from the Wispbyte server -->
<script src="http://212.132.120.102:13888/socket.io/socket.io.js"
  onerror="document.getElementById('connStatus').textContent='âœ— FAILED TO LOAD SOCKET.IO';document.getElementById('connStatus').className='err'">
</script>
<script>
const SERVER  = 'http://212.132.120.102:13888';
const XP_TBL  = [0,100,250,450,700,1050,1500,2100,2900,4000,5500];

// Canvas
const canvas  = document.getElementById('c');
const ctx     = canvas.getContext('2d');
const mmc     = document.getElementById('mmc');
const mmx     = mmc.getContext('2d');
function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }
resize(); addEventListener('resize', resize);

// State
let socket, myId;
let me=null, mapData=null, itemDefs={};
let worldPlayers={}, worldAnimals={}, worldDrops={};
let hits=[], floats=[];
let keys={}, camX=0, camY=0, started=false;

// â”€â”€ Connection probe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const statusEl = document.getElementById('connStatus');
const playBtn  = document.getElementById('playBtn');

function probe(){
  if(typeof io === 'undefined'){
    statusEl.textContent='âœ— SERVER UNREACHABLE'; statusEl.className='err';
    setTimeout(()=>location.reload(), 5000); return;
  }
  statusEl.textContent='âŸ³ CONNECTING...'; statusEl.className='';
  const s = io(SERVER, {reconnection:false, timeout:5000});
  s.on('connect', ()=>{
    statusEl.textContent='âœ“ SERVER ONLINE'; statusEl.className='ok';
    playBtn.disabled=false; s.disconnect();
  });
  s.on('connect_error', ()=>{
    statusEl.textContent='âœ— SERVER OFFLINE â€” RETRYING'; statusEl.className='err';
    playBtn.disabled=true; setTimeout(probe, 4000);
  });
}
probe();

// â”€â”€ Lobby â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
playBtn.onclick = go;
document.getElementById('nameIn').onkeydown = e=>{ if(e.key==='Enter'&&!playBtn.disabled) go(); };
function go(){
  if(started) return; started=true;
  const name = document.getElementById('nameIn').value.trim()||'Wanderer';
  document.getElementById('lobby').style.display='none';
  document.getElementById('hud').style.display='block';
  connect(name);
  requestAnimationFrame(loop);
}

// â”€â”€ Socket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function connect(name){
  socket = io(SERVER, {reconnection:true, reconnectionAttempts:10});
  socket.on('connect', ()=>{ myId=socket.id; socket.emit('join',{name}); });
  socket.on('disconnect', ()=> document.getElementById('dcScreen').style.display='flex');

  socket.on('init', d=>{
    me=d.me; itemDefs=d.items; mapData=d.map; updateHUD(); buildInv();
  });
  socket.on('state', d=>{
    worldPlayers={}; d.players.forEach(p=>worldPlayers[p.id]=p);
    worldAnimals={}; d.animals.forEach(a=>worldAnimals[a.id]=a);
    worldDrops={};   d.drops.forEach(g=>worldDrops[g.id]=g);
    const wp=worldPlayers[myId];
    if(wp&&me){me.x=wp.x;me.y=wp.y;me.hp=wp.hp;me.level=wp.level;}
  });
  socket.on('xpGain', d=>{
    if(me){me.xp=d.xp;me.level=d.level;}
    fl(me?.x||0,(me?.y||0)-28,`+${d.amt} XP`,'#00e5ff',1100); updateHUD();
  });
  socket.on('levelUp', d=>{
    if(me) me.level=d.level;
    fl(me?.x||0,(me?.y||0)-50,'LEVEL UP!','#f5a623',1600);
    const f=document.getElementById('lvlFlash');
    f.classList.add('on'); setTimeout(()=>f.classList.remove('on'),700);
    updateHUD();
    if(d.level>=10) document.getElementById('islBanner').style.display='flex';
  });
  socket.on('hpUpdate', d=>{ if(me){me.hp=d.hp;me.maxHp=d.maxHp;} updateHUD(); });
  socket.on('hit', d=>{ hits.push({x:d.x,y:d.y,r:5,a:1}); fl(d.x,d.y-14,`-${d.dmg}`,'#e94560',800); });
  socket.on('invUpdate', d=>{ if(me){me.inv=d.inv;me.equipped=d.equipped;me.hp=d.hp;} buildInv();updateHUD(); });
  socket.on('killfeed', d=>kf(d.killer,d.victim));
  socket.on('youDied', d=>{
    document.getElementById('dBy').textContent=`Killed by ${d.by}`;
    document.getElementById('dK').textContent=me?.kills||0;
    document.getElementById('dP').textContent=me?.pvpKills||0;
    document.getElementById('dL').textContent=me?.level||1;
    document.getElementById('death').style.display='flex';
    if(me) me.dead=true;
  });
  socket.on('respawned', d=>{ me=d; document.getElementById('death').style.display='none'; buildInv();updateHUD(); });
  socket.on('animalDied',  id=>delete worldAnimals[id]);
  socket.on('dropRemoved', id=>delete worldDrops[id]);
  socket.on('dropAdded',   g=>{ if(g) worldDrops[g.id]=g; });
  document.getElementById('rbtn').onclick=()=>socket.emit('respawn');
}

// â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
addEventListener('keydown',e=>keys[e.code]=true);
addEventListener('keyup',  e=>keys[e.code]=false);
setInterval(()=>{
  if(!socket||!me||me.dead) return;
  let vx=0,vy=0;
  if(keys['KeyW']||keys['ArrowUp'])   vy=-1;
  if(keys['KeyS']||keys['ArrowDown']) vy= 1;
  if(keys['KeyA']||keys['ArrowLeft']) vx=-1;
  if(keys['KeyD']||keys['ArrowRight'])vx= 1;
  if(vx&&vy){vx*=.707;vy*=.707;}
  socket.emit('move',{vx,vy});
},33);
canvas.addEventListener('click',e=>{
  if(!socket||!me||me.dead) return;
  const wx=e.clientX+camX,wy=e.clientY+camY;
  for(const a of Object.values(worldAnimals)){
    if(Math.hypot(a.x-wx,a.y-wy)<a.r+14){socket.emit('atkAnimal',{id:a.id});return;}
  }
  for(const p of Object.values(worldPlayers)){
    if(p.id===myId) continue;
    if(Math.hypot(p.x-wx,p.y-wy)<24){socket.emit('atkPlayer',{id:p.id});return;}
  }
});

// â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateHUD(){
  if(!me) return;
  document.getElementById('sName').textContent=(me.name||'').toUpperCase();
  const hp=Math.max(0,me.hp);
  document.getElementById('hpB').style.width=(hp/me.maxHp*100)+'%';
  document.getElementById('hpV').textContent=`${Math.ceil(hp)}/${me.maxHp}`;
  const nx=XP_TBL[Math.min(me.level,10)]||5500;
  document.getElementById('xpB').style.width=Math.min(100,me.xp/nx*100)+'%';
  document.getElementById('xpV').textContent=`${me.xp}/${nx}`;
  document.getElementById('sLvl').textContent=`LVL ${me.level}${me.level>=10?' âœ¦ MAX':''}`;
  document.getElementById('sKills').textContent=`Kills: ${me.kills||0} | PvP: ${me.pvpKills||0}`;
}

// â”€â”€ Inventory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildInv(){
  const bar=document.getElementById('invBar'); bar.innerHTML='';
  const inv=me?.inv||[], eq=me?.equipped||{};
  const eqSet=new Set(Object.values(eq).filter(Boolean));
  for(let i=0;i<10;i++){
    const sl=document.createElement('div'); sl.className='isl';
    if(inv[i]){
      const def=itemDefs[inv[i].itemId];
      if(def){
        if(eqSet.has(inv[i].itemId)) sl.classList.add('eq');
        sl.textContent=def.icon;
        const nm=document.createElement('span'); nm.className='sn'; nm.textContent=def.name; sl.appendChild(nm);
        sl.dataset.iid=inv[i].id; sl.dataset.itemId=inv[i].itemId;
        sl.addEventListener('mouseenter',showTip); sl.addEventListener('mouseleave',hideTip); sl.addEventListener('mousemove',movTip);
        sl.addEventListener('click',()=>{socket.emit('useItem',{invId:inv[i].id});hideTip();});
        sl.addEventListener('contextmenu',e=>{e.preventDefault();socket.emit('dropItem',{invId:inv[i].id});hideTip();});
      }
    } else { sl.innerHTML='<span class="iempty">+</span>'; }
    bar.appendChild(sl);
  }
}
function showTip(e){
  const def=itemDefs[e.currentTarget.dataset.itemId]; if(!def) return;
  const rc={common:'rc',uncommon:'ru',rare:'rr'}[def.rarity]||'rc';
  document.getElementById('tip').innerHTML=`
    <div class="tn">${def.icon} ${def.name}</div><div class="${rc}">${(def.rarity||'').toUpperCase()}</div>
    ${def.dmg?`<div style="color:#e94560;font-size:10px">âš” DMG ${def.dmg}</div>`:''}
    ${def.def?`<div style="color:#00e5ff;font-size:10px">ğŸ›¡ DEF ${def.def}</div>`:''}
    ${def.heal?`<div style="color:#39ff8f;font-size:10px">â¤ HEAL ${def.heal>=999?'Full HP':def.heal}</div>`:''}
    <div class="th">Click: Use/Equip Â· Right-click: Drop</div>`;
  document.getElementById('tip').style.display='block'; movTip(e);
}
function hideTip(){document.getElementById('tip').style.display='none';}
function movTip(e){const t=document.getElementById('tip');t.style.left=(e.clientX+14)+'px';t.style.top=(e.clientY-10)+'px';}

// â”€â”€ Kill feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kf(killer,victim){
  const el=document.createElement('div'); el.className='kfe';
  el.innerHTML=`<span class="kk">${killer}</span> slew <span class="kv">${victim}</span>`;
  document.getElementById('kf').appendChild(el); setTimeout(()=>el.remove(),4000);
}

// â”€â”€ Float text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fl(x,y,txt,col,life){floats.push({x,y,txt,col,life,maxLife:life,vy:-0.85});}

// â”€â”€ Minimap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawMM(){
  if(!mapData||!me) return;
  const W=158,H=158,sx=W/mapData.w,sy=H/mapData.h;
  mmx.clearRect(0,0,W,H); mmx.fillStyle='#0d0f1e'; mmx.fillRect(0,0,W,H);
  mmx.fillStyle='rgba(39,80,45,.45)';
  mapData.trees.forEach(t=>mmx.fillRect(t.x*sx-1,t.y*sy-1,2,2));
  mmx.fillStyle='#e94560';
  Object.values(worldAnimals).forEach(a=>mmx.fillRect(a.x*sx-1.5,a.y*sy-1.5,3,3));
  mmx.fillStyle='#00e5ff';
  Object.values(worldPlayers).forEach(p=>{if(p.id===myId)return;mmx.fillRect(p.x*sx-2,p.y*sy-2,4,4);});
  mmx.fillStyle='#fff'; mmx.fillRect(me.x*sx-3,me.y*sy-3,6,6);
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TILE=80;
function draw(){
  const W=canvas.width,H=canvas.height;
  if(!mapData||!me){ctx.clearRect(0,0,W,H);return;}
  const wp=worldPlayers[myId]||me;
  camX+=(wp.x-W/2-camX)*.1; camY+=(wp.y-H/2-camY)*.1;
  ctx.save(); ctx.translate(-camX,-camY);
  ctx.fillStyle='#07080f'; ctx.fillRect(camX,camY,W,H);
  // Grid
  ctx.strokeStyle='rgba(30,34,64,.5)'; ctx.lineWidth=.5;
  for(let x=Math.floor(camX/TILE)*TILE;x<camX+W;x+=TILE){ctx.beginPath();ctx.moveTo(x,camY);ctx.lineTo(x,camY+H);ctx.stroke();}
  for(let y=Math.floor(camY/TILE)*TILE;y<camY+H;y+=TILE){ctx.beginPath();ctx.moveTo(camX,y);ctx.lineTo(camX+W,y);ctx.stroke();}
  // Border
  ctx.strokeStyle='rgba(0,229,255,.22)'; ctx.lineWidth=3; ctx.strokeRect(0,0,mapData.w,mapData.h);
  // Trees
  mapData.trees.forEach(t=>{
    ctx.beginPath();ctx.arc(t.x,t.y,t.r*1.1,0,Math.PI*2);ctx.fillStyle='rgba(15,40,20,.7)';ctx.fill();
    ctx.font=`${t.r*1.5}px serif`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('ğŸŒ²',t.x,t.y);
  });
  // Rocks
  mapData.rocks.forEach(r=>{ctx.font=`${r.r*1.5}px serif`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('ğŸª¨',r.x,r.y);});
  // Drops
  Object.values(worldDrops).forEach(d=>{
    const def=itemDefs[d.itemId]; if(!def) return;
    ctx.save();ctx.shadowColor='#00e5ff';ctx.shadowBlur=10;
    ctx.font='18px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(def.icon,d.x,d.y);ctx.restore();
  });
  // Animals
  Object.values(worldAnimals).forEach(a=>{
    const bw=a.r*2.2;
    ctx.fillStyle='#1e2240';ctx.fillRect(a.x-bw/2,a.y-a.r-16,bw,4);
    ctx.fillStyle='#e94560';ctx.fillRect(a.x-bw/2,a.y-a.r-16,bw*(a.hp/a.maxHp),4);
    ctx.font=`${a.r*1.7}px serif`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(a.icon,a.x,a.y);
    ctx.fillStyle='#5a6a90';ctx.font='9px DM Mono';ctx.fillText(a.name,a.x,a.y-a.r-20);
  });
  // Players
  Object.values(worldPlayers).forEach(p=>drawP(p,p.id===myId));
  // Hits
  hits=hits.filter(h=>h.a>0);
  hits.forEach(h=>{h.r+=1.2;h.a-=.055;ctx.save();ctx.beginPath();ctx.arc(h.x,h.y,h.r,0,Math.PI*2);ctx.strokeStyle=`rgba(233,69,96,${h.a})`;ctx.lineWidth=2;ctx.stroke();ctx.restore();});
  // Floats
  floats=floats.filter(f=>f.life>0);
  floats.forEach(f=>{f.life-=16;f.y+=f.vy;ctx.save();ctx.globalAlpha=Math.min(1,f.life/(f.maxLife*.4));ctx.fillStyle=f.col;ctx.font='bold 13px DM Mono';ctx.textAlign='center';ctx.fillText(f.txt,f.x,f.y);ctx.restore();});
  ctx.restore();
  drawMM();
}

function drawP(p,isMe){
  const r=18; ctx.save();
  const bw=50,hp=Math.max(0,p.hp)/p.maxHp;
  ctx.fillStyle='#1e2240';ctx.fillRect(p.x-bw/2,p.y-r-24,bw,4);
  ctx.fillStyle=hp>.5?'#39ff8f':hp>.25?'#f5a623':'#e94560';ctx.fillRect(p.x-bw/2,p.y-r-24,bw*hp,4);
  if(isMe){ctx.shadowColor='#00e5ff';ctx.shadowBlur=18;}
  ctx.beginPath();ctx.arc(p.x,p.y,r,0,Math.PI*2);
  ctx.fillStyle=isMe?'#0d1a2e':'#2a0d14';ctx.fill();
  ctx.strokeStyle=isMe?'#00e5ff':'#e94560';ctx.lineWidth=isMe?2.5:1.5;ctx.stroke();
  ctx.shadowBlur=0;
  if(p.equipped?.weapon&&itemDefs[p.equipped.weapon]){
    ctx.font='13px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(itemDefs[p.equipped.weapon].icon,p.x+10,p.y+9);
  }
  ctx.fillStyle=isMe?'#00e5ff':'#e94560';ctx.font=`${isMe?'bold ':''}10px DM Mono`;ctx.textAlign='center';
  ctx.fillText(`${p.name} [${p.level}]`,p.x,p.y-r-28);
  ctx.restore();
}

function loop(){draw();requestAnimationFrame(loop);}
</script>
</body>
</html>