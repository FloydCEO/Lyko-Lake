<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LykoIO – LilLyko.space</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=DM+Mono&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;background:#07080f;overflow:hidden;
  font-family:'DM Mono',monospace;color:#dce8ff}

#gameFrame{
  position:fixed;inset:0;width:100%;height:100%;border:none;
  opacity:0;transition:opacity .5s;z-index:1
}
#overlay{
  position:fixed;inset:0;background:#07080f;z-index:10;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;
  transition:opacity .4s
}
#overlay.fade{opacity:0;pointer-events:none}

.owrap{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  width:580px;height:580px;pointer-events:none;opacity:.05}
.orb{position:absolute;inset:0;border:1px solid #fff;border-radius:50%;animation:spin 40s linear infinite}
.orb:nth-child(2){inset:55px;border-color:#00e5ff;animation-duration:58s;animation-direction:reverse}
.orb:nth-child(3){inset:120px;animation-duration:75s}
@keyframes spin{to{transform:rotate(360deg)}}
.scanlines{position:fixed;inset:0;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.025) 2px,rgba(0,0,0,.025) 4px)}

.inner{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:0;text-align:center}
.logo{font-family:'Orbitron',sans-serif;font-size:clamp(52px,9vw,90px);
  color:#fff;letter-spacing:2px;line-height:1;margin-bottom:20px}
.logo .io{color:#00e5ff}

#statusLine{font-size:10px;letter-spacing:3px;color:#5a6a90;text-transform:uppercase;
  margin-bottom:14px;transition:color .3s}
#statusLine.ok{color:#39ff8f}
#statusLine.err{color:#e94560}

.pbar{width:200px;height:2px;background:#1e2240;overflow:hidden;margin-bottom:20px;transition:opacity .3s}
.pfill{height:100%;width:35%;
  background:linear-gradient(90deg,transparent,#00e5ff,transparent);
  animation:sweep 1.5s ease-in-out infinite}
@keyframes sweep{from{transform:translateX(-200%)}to{transform:translateX(500%)}}
.pbar.hidden{opacity:0}

.btn-row{display:flex;gap:10px;margin-top:4px}
.btn{background:transparent;font-family:'DM Mono',monospace;font-size:9px;
  letter-spacing:3px;text-transform:uppercase;padding:10px 22px;
  cursor:pointer;transition:all .2s;display:none}
.btn.show{display:block}
.btn-retry{border:1px solid #1e2240;color:#5a6a90}
.btn-retry:hover{border-color:#00e5ff;color:#00e5ff}
.btn-offline{border:1px solid #1e2240;color:#5a6a90}
.btn-offline:hover{border-color:#f5a623;color:#f5a623}

#errDetail{font-size:9px;letter-spacing:1px;color:#2a3050;margin-top:8px;max-width:340px;
  line-height:1.9;display:none;text-align:center}
#errDetail.show{display:block}
</style>
</head>
<body>

<div id="overlay">
  <div class="owrap"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>
  <div class="scanlines"></div>
  <div class="inner">
    <div class="logo">LYKO<span class="io">IO</span></div>
    <div id="statusLine">Connecting to server...</div>
    <div class="pbar" id="pbar"><div class="pfill"></div></div>
    <div class="btn-row">
      <button class="btn btn-retry"   id="retryBtn"   onclick="tryLoad()">↺ Retry</button>
      <button class="btn btn-offline" id="offlineBtn" onclick="goOffline()">Play Offline</button>
    </div>
    <div id="errDetail"></div>
  </div>
</div>

<iframe
  id="gameFrame"
  src="about:blank"
  sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups allow-modals"
  allowfullscreen
></iframe>

<script>
// ══════════════════════════════════════════════════════════════════════════════
//  SERVER URL — Wispbyte proxies your Node server through HTTPS via the
//  Custom Subdomains feature. You've added lillyko.space there (ACTIVE).
//
//  BUT: lillyko.space root is also your GitHub Pages site, which causes a
//  conflict. The cleanest fix:
//
//  Option A (recommended): In Wispbyte Custom Subdomains, click "+ Add Subdomain"
//  and add "game.lillyko.space". Then add an A record in Cloudflare DNS:
//    Name: game   →   IP: 212.132.120.102
//  Then change SERVER below to 'https://game.lillyko.space'
//
//  Option B (quick test): If lillyko.space is currently routing to your
//  Wispbyte server (not GitHub Pages), just use 'https://lillyko.space'
//  Change whichever one works for you below:
// ══════════════════════════════════════════════════════════════════════════════
const SERVER = 'https://game.lillyko.space'; // ← change this if needed

const GAME_URL    = SERVER + '/Lykoio.html';
const OFFLINE_URL = 'Lykoio_offline.html';

const frame      = document.getElementById('gameFrame');
const overlay    = document.getElementById('overlay');
const statusLine = document.getElementById('statusLine');
const pbar       = document.getElementById('pbar');
const retryBtn   = document.getElementById('retryBtn');
const offlineBtn = document.getElementById('offlineBtn');
const errDetail  = document.getElementById('errDetail');

let loadAttempt = 0;

function setLoading(msg) {
  statusLine.textContent = msg || 'Connecting to server...';
  statusLine.className = '';
  pbar.classList.remove('hidden');
  retryBtn.classList.remove('show');
  offlineBtn.classList.remove('show');
  errDetail.classList.remove('show');
  errDetail.textContent = '';
}

function setError(msg, detail) {
  statusLine.textContent = msg;
  statusLine.className = 'err';
  pbar.classList.add('hidden');
  retryBtn.classList.add('show');
  offlineBtn.classList.add('show');
  if (detail) { errDetail.textContent = detail; errDetail.classList.add('show'); }
}

function showGame() {
  overlay.classList.add('fade');
  frame.style.opacity = '1';
  setTimeout(() => overlay.style.display = 'none', 450);
}

function tryLoad() {
  loadAttempt++;
  setLoading(loadAttempt > 1 ? 'Retrying...' : 'Connecting to server...');

  // Use an image probe instead of fetch — avoids mixed content issues entirely
  // because image loads don't trigger mixed content blocks the same way
  const img = new Image();
  const timer = setTimeout(() => {
    img.src = ''; // cancel
    setError('✗ Server down', 'Connection timed out. Try again or play offline.');
  }, 7000);

  img.onload = () => {
    clearTimeout(timer);
    statusLine.textContent = '✓ Server found — loading game...';
    statusLine.className = 'ok';
    setTimeout(() => { frame.src = GAME_URL; }, 400);
  };

  img.onerror = () => {
    // onerror fires even for valid servers that return non-image responses
    // If the server is UP, we'll still get an error (it's not an image)
    // but the error fires quickly. If the server is DOWN, it takes longer / times out.
    // So we use timing: fast error = server up, slow = server down
    const elapsed = Date.now() - startT;
    if (elapsed < 5000) {
      // Server responded (just not with an image) — it's up
      clearTimeout(timer);
      statusLine.textContent = '✓ Server found — loading game...';
      statusLine.className = 'ok';
      setTimeout(() => { frame.src = GAME_URL; }, 400);
    } else {
      clearTimeout(timer);
      setError('✗ Server down', 'Could not reach the server. Try again or play offline.');
    }
  };

  const startT = Date.now();
  img.src = SERVER + '/favicon.ico?_=' + Date.now();
}

frame.addEventListener('load', () => {
  if (!frame.src || frame.src === 'about:blank') return;
  showGame();
});

function goOffline() {
  setLoading('Loading offline mode...');
  frame.src = OFFLINE_URL;
}

tryLoad();
</script>
</body>
</html>