<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LykoIO – LilLyko.space</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=DM+Mono&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;background:#07080f;overflow:hidden;
  font-family:'DM Mono',monospace;color:#dce8ff}

#gameFrame{
  position:fixed;inset:0;width:100%;height:100%;border:none;
  opacity:0;transition:opacity .5s;z-index:1
}

#overlay{
  position:fixed;inset:0;background:#07080f;z-index:10;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;
  transition:opacity .4s
}
#overlay.fade{opacity:0;pointer-events:none}

.owrap{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  width:580px;height:580px;pointer-events:none;opacity:.05}
.orb{position:absolute;inset:0;border:1px solid #fff;border-radius:50%;animation:spin 40s linear infinite}
.orb:nth-child(2){inset:55px;border-color:#00e5ff;animation-duration:58s;animation-direction:reverse}
.orb:nth-child(3){inset:120px;animation-duration:75s}
@keyframes spin{to{transform:rotate(360deg)}}
.scanlines{position:fixed;inset:0;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.025) 2px,rgba(0,0,0,.025) 4px)}

.inner{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:0;text-align:center}
.logo{font-family:'Orbitron',sans-serif;font-size:clamp(52px,9vw,90px);
  color:#fff;letter-spacing:2px;line-height:1;margin-bottom:20px}
.logo .io{color:#00e5ff}

#statusLine{font-size:10px;letter-spacing:3px;color:#5a6a90;text-transform:uppercase;
  margin-bottom:14px;transition:color .3s}
#statusLine.ok{color:#39ff8f}
#statusLine.err{color:#e94560}

.pbar{width:200px;height:2px;background:#1e2240;overflow:hidden;margin-bottom:20px;transition:opacity .3s}
.pfill{height:100%;width:35%;
  background:linear-gradient(90deg,transparent,#00e5ff,transparent);
  animation:sweep 1.5s ease-in-out infinite}
@keyframes sweep{from{transform:translateX(-200%)}to{transform:translateX(500%)}}
.pbar.hidden{opacity:0}

.btn-row{display:flex;gap:10px;margin-top:4px}
.btn{background:transparent;font-family:'DM Mono',monospace;font-size:9px;
  letter-spacing:3px;text-transform:uppercase;padding:10px 22px;
  cursor:pointer;transition:all .2s;display:none}
.btn.show{display:block}
.btn-retry{border:1px solid #1e2240;color:#5a6a90}
.btn-retry:hover{border-color:#00e5ff;color:#00e5ff}
.btn-offline{border:1px solid #1e2240;color:#5a6a90}
.btn-offline:hover{border-color:#f5a623;color:#f5a623}
.btn-offline:disabled{opacity:.3;cursor:not-allowed;border-color:#1e2240;color:#5a6a90}

#errDetail{font-size:9px;letter-spacing:1px;color:#2a3050;margin-top:8px;max-width:340px;
  line-height:1.9;display:none;text-align:center}
#errDetail.show{display:block}

/* Offline "coming soon" popup */
#offlinePopup{
  position:fixed;inset:0;background:rgba(7,8,15,.92);z-index:20;
  display:none;flex-direction:column;align-items:center;justify-content:center;gap:14px}
#offlinePopup.show{display:flex}
.popup-box{background:#121428;border:1px solid #1e2240;padding:28px 36px;
  max-width:340px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:12px}
.popup-title{font-family:'Orbitron',sans-serif;font-size:13px;color:#fff;letter-spacing:2px}
.popup-text{font-size:10px;letter-spacing:1px;color:#5a6a90;line-height:1.9}
.popup-text b{color:#f5a623;font-weight:400}
.popup-close{background:transparent;border:1px solid #1e2240;color:#5a6a90;
  font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;text-transform:uppercase;
  padding:9px 22px;cursor:pointer;transition:all .2s;margin-top:4px}
.popup-close:hover{border-color:#00e5ff;color:#00e5ff}
</style>
</head>
<body>

<!-- Loading / error overlay -->
<div id="overlay">
  <div class="owrap"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>
  <div class="scanlines"></div>
  <div class="inner">
    <div class="logo">LYKO<span class="io">IO</span></div>
    <div id="statusLine">Connecting to server...</div>
    <div class="pbar" id="pbar"><div class="pfill"></div></div>
    <div class="btn-row">
      <button class="btn btn-retry"   id="retryBtn"   onclick="tryLoad()">↺ Retry</button>
      <button class="btn btn-offline" id="offlineBtn" onclick="showOfflinePopup()">Play Offline</button>
    </div>
    <div id="errDetail"></div>
  </div>
</div>

<!-- Offline mode popup (coming soon) -->
<div id="offlinePopup">
  <div class="popup-box">
    <div class="popup-title">OFFLINE MODE</div>
    <div class="popup-text">
      Offline mode is <b>coming soon</b>.<br><br>
      For now the game requires a server connection.<br>
      Try again later or hit Retry — the server may just be restarting.
    </div>
    <button class="popup-close" onclick="closeOfflinePopup()">← Go Back</button>
  </div>
</div>

<!-- The actual game loads in here — users still see lillyko.space/Lykoio.html in URL bar -->
<iframe
  id="gameFrame"
  src="about:blank"
  sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups allow-modals"
  allowfullscreen
></iframe>

<script>
// Your Wispbyte server IP + port
const SERVER   = 'http://212.132.120.102:13888';
const GAME_URL = SERVER + '/Lykoio.html';

const frame      = document.getElementById('gameFrame');
const overlay    = document.getElementById('overlay');
const statusLine = document.getElementById('statusLine');
const pbar       = document.getElementById('pbar');
const retryBtn   = document.getElementById('retryBtn');
const offlineBtn = document.getElementById('offlineBtn');
const errDetail  = document.getElementById('errDetail');

let loadAttempt = 0;

function setLoading(msg) {
  statusLine.textContent = msg || 'Connecting to server...';
  statusLine.className = '';
  pbar.classList.remove('hidden');
  retryBtn.classList.remove('show');
  offlineBtn.classList.remove('show');
  errDetail.classList.remove('show');
  errDetail.textContent = '';
}

function setError(msg, detail) {
  statusLine.textContent = msg;
  statusLine.className = 'err';
  pbar.classList.add('hidden');
  retryBtn.classList.add('show');
  offlineBtn.classList.add('show');
  if (detail) {
    errDetail.textContent = detail;
    errDetail.classList.add('show');
  }
}

function tryLoad() {
  loadAttempt++;
  setLoading(loadAttempt > 1 ? 'Retrying...' : 'Connecting to server...');

  const controller = new AbortController();
  const killTimer  = setTimeout(() => controller.abort(), 7000);

  fetch(SERVER + '/socket.io/socket.io.js', {
    method: 'HEAD',
    mode:   'no-cors',
    signal: controller.signal
  })
  .then(() => {
    clearTimeout(killTimer);
    statusLine.textContent = '✓ Server found — loading game...';
    statusLine.className = 'ok';
    setTimeout(() => { frame.src = GAME_URL; }, 400);
  })
  .catch(err => {
    clearTimeout(killTimer);
    if (err.name === 'AbortError') {
      setError('✗ Server down', 'Connection timed out. The server may be restarting — try again in a moment.');
    } else {
      setError('✗ Server down', 'Could not reach the game server. Try again shortly.');
    }
  });
}

// Fade overlay and show game once iframe loads
frame.addEventListener('load', () => {
  if (!frame.src || frame.src === 'about:blank') return;
  overlay.classList.add('fade');
  frame.style.opacity = '1';
  setTimeout(() => overlay.style.display = 'none', 450);
});

// Offline popup
function showOfflinePopup() {
  document.getElementById('offlinePopup').classList.add('show');
}
function closeOfflinePopup() {
  document.getElementById('offlinePopup').classList.remove('show');
}

tryLoad();
</script>
</body>
</html>